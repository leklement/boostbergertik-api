// @bun
import s from"elysia";var I={"default-src":["'self'"],"base-uri":["'self'"],"font-src":["'self'","https:","data:"],"form-action":["'self'"],"frame-ancestors":["'self'"],"img-src":["'self'","data:"],"object-src":["'none'"],"script-src":["'self'"],"script-src-attr":["'none'"],"style-src":["'self'","https:","'unsafe-inline'"],"upgrade-insecure-requests":[]},f=(J)=>J.replace(/[A-Z]/g,(q)=>`-${q.toLowerCase()}`),A=(J)=>/;|,/.test(J),k=(J,q)=>Object.prototype.hasOwnProperty.call(J,q),w=()=>({...I}),L=(J)=>{const q=w(),{useDefaults:X=!0,directives:B=q}=J,R=new Map,Y=new Set,$=new Set;for(let G in B){if(!k(B,G))continue;if(G.length===0||/[^a-zA-Z0-9-]/.test(G))throw new Error(`Content-Security-Policy received an invalid directive name ${JSON.stringify(G)}`);const Q=f(G);if(Y.has(Q))throw new Error(`Content-Security-Policy received a duplicate directive ${JSON.stringify(Q)}`);Y.add(Q);const Z=B[G];if(Z===null){if(Q==="default-src")throw new Error("Content-Security-Policy needs a default-src but it was set to `null`.");$.add(Q);continue}if(!Z)throw new Error(`Content-Security-Policy received an invalid directive value for ${JSON.stringify(Q)}`);const j=typeof Z==="string"?[Z]:Z;for(let x of j)if(typeof x==="string"&&A(x))throw new Error(`Content-Security-Policy received an invalid directive value for ${JSON.stringify(Q)}`);R.set(Q,j)}if(X)Object.entries(q).forEach(([G,Q])=>{if(!R.has(G)&&!$.has(G))R.set(G,Q)});if(!R.size)throw new Error("Content-Security-Policy has no directives. Either set some or disable the header");return R},E=(J)=>{let q;const X=[];return J.forEach((B,R)=>{const Y=B.reduce(($,G)=>`${$} ${G}`,"");if(!Y)X.push(R);else if(A(Y))q=new Error(`Content-Security-Policy received an invalid directive value for ${JSON.stringify(R)}`);else X.push(`${R}${Y}`)}),q||X.join(";")},K=(J={})=>{const q=J.reportOnly?"Content-Security-Policy-Report-Only":"Content-Security-Policy",X=L(J),B=E(X);if(B instanceof Error)throw B;return[q,B]};var O=new Set(["require-corp","credentialless"]),y=({policy:J="require-corp"})=>{if(O.has(J))return J;throw new Error(`Cross-Origin-Embedder-Policy does not support the ${JSON.stringify(J)} policy`)},U=(J={})=>{return["Cross-Origin-Embedder-Policy",y(J)]};var V=new Set(["same-origin","same-origin-allow-popups","unsafe-none"]),N=({policy:J="same-origin"})=>{if(V.has(J))return J;throw new Error(`Cross-Origin-Opener-Policy does not support the ${JSON.stringify(J)} policy`)},b=(J={})=>{return["Cross-Origin-Opener-Policy",N(J)]};var H=new Set(["same-origin","same-site","cross-origin"]),D=({policy:J="same-origin"})=>{if(H.has(J))return J;throw new Error(`Cross-Origin-Resource-Policy does not support the ${JSON.stringify(J)} policy`)},z=(J={})=>{return["Cross-Origin-Resource-Policy",D(J)]};var M=()=>{return["Cross-Origin-Resource-Policy","?1"]};var m=new Set(["no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url",""]),u=({policy:J="no-referrer"})=>{const q=typeof J==="string"?[J]:J;if(q.length===0)throw new Error("Referrer-Policy received no policy tokens");const X=new Set;return q.forEach((B)=>{if(!m.has(B))throw new Error(`Referrer-Policy received an unexpected policy token ${JSON.stringify(B)}`);else if(X.has(B))throw new Error(`Referrer-Policy received a duplicate policy token ${JSON.stringify(B)}`);X.add(B)}),q.join(",")},h=(J={})=>{return["Referrer-Policy",u(J)]};var n=(J=15552000)=>{if(J>=0&&Number.isFinite(J))return Math.floor(J);throw new Error(`Strict-Transport-Security: ${JSON.stringify(J)} is not a valid value for maxAge. Please choose a positive integer.`)},v=(J)=>{if("maxage"in J)throw new Error("Strict-Transport-Security received an unsupported property, `maxage`. Did you mean to pass `maxAge`?");if("includeSubdomains"in J)throw new Error('Strict-Transport-Security middleware should use `includeSubDomains` instead of `includeSubdomains`. (The correct one has an uppercase "D".)');const q=[`max-age=${n(J.maxAge)}`];if(J.includeSubDomains===void 0||J.includeSubDomains)q.push("includeSubDomains");if(J.preload)q.push("preload");return q.join("; ")},g=(J={})=>{return["Strict-Transport-Security",v(J)]};var T=()=>{return["X-Content-Type-Options","nosniff"]};var W=(J={})=>{return["X-DNS-Prefetch-Control",J.allow?"on":"off"]};var C=()=>{return["X-Download-Options","noopen"]};var p=({action:J="sameorigin"})=>{const q=typeof J==="string"?J.toUpperCase():J;switch(q){case"SAME-ORIGIN":return"SAMEORIGIN";case"DENY":case"SAMEORIGIN":return q;default:throw new Error(`X-Frame-Options received an invalid action ${JSON.stringify(J)}`)}},P=(J={})=>{return["X-Frame-Options",p(J)]};var d=new Set(["none","master-only","by-content-type","all"]),c=({permittedPolicies:J="none"})=>{if(d.has(J))return J;throw new Error(`X-Permitted-Cross-Domain-Policies does not support ${JSON.stringify(J)}`)},S=(J={})=>{return["X-Permitted-Cross-Domain-Policies",c(J)]};var _=()=>{return["X-XSS-Protection","0"]};var F=(J,q,X)=>{switch(X.contentSecurityPolicy){case void 0:case!0:J(K());break;case!1:break;default:J(K(X.contentSecurityPolicy));break}switch(X.crossOriginEmbedderPolicy){case void 0:case!1:break;case!0:J(U());break;default:J(U(X.crossOriginEmbedderPolicy));break}switch(X.crossOriginOpenerPolicy){case void 0:case!0:J(b());break;case!1:break;default:J(b(X.crossOriginOpenerPolicy));break}switch(X.crossOriginResourcePolicy){case void 0:case!0:J(z());break;case!1:break;default:J(z(X.crossOriginResourcePolicy));break}switch(X.originAgentCluster){case void 0:case!0:J(M());break;case!1:break;default:J(M());break}switch(X.referrerPolicy){case void 0:case!0:J(h());break;case!1:break;default:J(h(X.referrerPolicy));break}if(("strictTransportSecurity"in X)&&("hsts"in X))throw new Error("Strict-Transport-Security option was specified twice. Remove `hsts` to silence this warning.");const B=X.strictTransportSecurity??X.hsts;switch(B){case void 0:case!0:J(g());break;case!1:break;default:J(g(B));break}if(("xContentTypeOptions"in X)&&("noSniff"in X))throw new Error("X-Content-Type-Options option was specified twice. Remove `noSniff` to silence this warning.");switch(X.xContentTypeOptions??X.noSniff){case void 0:case!0:J(T());break;case!1:break;default:J(T());break}if(("xDnsPrefetchControl"in X)&&("dnsPrefetchControl"in X))throw new Error("X-DNS-Prefetch-Control option was specified twice. Remove `dnsPrefetchControl` to silence this warning.");const Y=X.xDnsPrefetchControl??X.dnsPrefetchControl;switch(Y){case void 0:case!0:J(W());break;case!1:break;default:J(W(Y));break}if(("xDownloadOptions"in X)&&("ieNoOpen"in X))throw new Error("X-Download-Options option was specified twice. Remove `ieNoOpen` to silence this warning.");switch(X.xDownloadOptions??X.ieNoOpen){case void 0:case!0:J(C());break;case!1:break;default:J(C());break}if(("xFrameOptions"in X)&&("frameguard"in X))throw new Error("X-Frame-Options option was specified twice. Remove `frameguard` to silence this warning.");const G=X.xFrameOptions??X.frameguard;switch(G){case void 0:case!0:J(P());break;case!1:break;default:J(P(G));break}if(("xPermittedCrossDomainPolicies"in X)&&("permittedCrossDomainPolicies"in X))throw new Error("X-Permitted-Cross-Domain-Policies option was specified twice. Remove `permittedCrossDomainPolicies` to silence this warning.");const Q=X.xPermittedCrossDomainPolicies??X.permittedCrossDomainPolicies;switch(Q){case void 0:case!0:J(S());break;case!1:break;default:J(S(Q));break}if(("xPoweredBy"in X)&&("hidePoweredBy"in X))throw new Error("X-Powered-By option was specified twice. Remove `hidePoweredBy` to silence this warning.");switch(X.xPoweredBy??X.hidePoweredBy){case void 0:case!0:q("X-Powered-By");break;case!1:break;default:q("X-Powered-By");break}if(("xXssProtection"in X)&&("xssFilter"in X))throw new Error("X-XSS-Protection option was specified twice. Remove `xssFilter` to silence this warning.");switch(X.xXssProtection??X.xssFilter){case void 0:case!0:J(_());break;case!1:break;default:J(_());break}};var EJ=(J={})=>{return new s({name:"elysia-helmet"}).on("request",({set:q})=>{F(([X,B])=>q.headers[X]=B,(X)=>delete q.headers[X],J)})};export{EJ as helmet};
